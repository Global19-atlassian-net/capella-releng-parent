<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright (c) 2020 THALES GLOBAL SERVICES.
  All rights reserved. This program and the accompanying materials
  are made available under the terms of the Eclipse Public License v1.0
  which accompanies this distribution, and is available at
  http://www.eclipse.org/legal/epl-v10.html

  Contributors:
       Thales - initial API and implementation
-->

<project
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
    xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>org.polarsys</groupId>
    <artifactId>capella-releng-parent</artifactId>
    <version>1.4.1-SNAPSHOT</version>
    <relativePath>capella-releng-parent.xml</relativePath>
  </parent>

  <name>Capella Builder</name>
  <artifactId>capella-builder</artifactId>
  <packaging>pom</packaging>

  <properties>
    <target-definition-groupId>org.polarsys</target-definition-groupId>
    <target-definition-classifier>${target-definition-artifactId}</target-definition-classifier>
    <target-definition-version>1.4.1-SNAPSHOT</target-definition-version>
  </properties>

  <build>
    <plugins>
      <plugin>
	<groupId>org.eclipse.tycho</groupId>
	<artifactId>target-platform-configuration</artifactId>
	<version>${tycho-version}</version>
	<configuration>
	  <target>
	    <artifact>
	      <groupId>${target-definition-groupId}</groupId>
	      <artifactId>${target-definition-artifactId}</artifactId>
	      <version>${target-definition-version}</version>
	    </artifact>
	  </target>
	  <environments>
	    <environment>
	      <os>win32</os>
	      <ws>win32</ws>
	      <arch>x86_64</arch>
	    </environment>
	    <environment>
	      <os>linux</os>
	      <ws>gtk</ws>
	      <arch>x86_64</arch>
	    </environment>
	    <environment>
	      <os>macosx</os>
	      <ws>cocoa</ws>
	      <arch>x86_64</arch>
	    </environment>
	  </environments>
	</configuration>
      </plugin>


      <!-- enable source feature generation -->
      <plugin>
	<groupId>org.eclipse.tycho.extras</groupId>
	<artifactId>tycho-source-feature-plugin</artifactId>
	<version>${tycho-extras-version}</version>
	<executions>
	  <execution>
	    <id>source-feature</id>
	    <phase>package</phase>
	    <goals>
	      <goal>source-feature</goal>
	    </goals>
	  </execution>
	</executions>
      </plugin>
      <plugin>
	<groupId>org.eclipse.tycho</groupId>
	<artifactId>tycho-source-plugin</artifactId>
	<version>${tycho-version}</version>
	<executions>
	  <execution>
	    <id>plugin-source</id>
	    <goals>
	      <goal>plugin-source</goal>
	    </goals>
	  </execution>
	</executions>
      </plugin>
      <plugin>
	<groupId>org.eclipse.tycho</groupId>
	<artifactId>tycho-p2-plugin</artifactId>
	<version>${tycho-version}</version>
	<executions>
	  <execution>
	    <id>attached-p2-metadata</id>
	    <phase>package</phase>
	    <goals>
	      <goal>p2-metadata</goal>
	    </goals>
	  </execution>
	</executions>
      </plugin>
      <plugin>
	<groupId>org.eclipse.tycho</groupId>
	<artifactId>tycho-packaging-plugin</artifactId>
	<version>${tycho-version}</version>
	<configuration>
	  <!--<strictBinIncludes>false</strictBinIncludes>-->
	  <sourceReferences>
	    <generate>true</generate>
	  </sourceReferences>
	</configuration>
	<dependencies>
	  <dependency>
	    <groupId>org.eclipse.tycho.extras</groupId>
	    <artifactId>tycho-sourceref-jgit</artifactId>
	    <version>${tycho-extras-version}</version>
	  </dependency>
	</dependencies>
      </plugin>
    </plugins>

    <pluginManagement>
      <plugins>
	<plugin>
	  <groupId>org.sonarsource.scanner.maven</groupId>
	  <artifactId>sonar-maven-plugin</artifactId>
	  <version>${sonar-version}</version>
	</plugin>	
	<plugin>
	  <groupId>org.jacoco</groupId>
	<artifactId>jacoco-maven-plugin</artifactId>
	<version>${jacoco-version}</version>
	<configuration>
	  <append>true</append>
	  <destFile>${sonar.jacoco.reportPath}</destFile>
	</configuration>
	<executions>
	  <execution>
	    <id>agent-for-ut</id>
	    <goals>
	      <goal>prepare-agent</goal>
	    </goals>
	  </execution>
	  <execution>
	    <id>jacoco-site</id>
	    <phase>verify</phase>
	    <goals>
	      <goal>report</goal>
	    </goals>
	  </execution>
	</executions>
      </plugin>
      </plugins>
    </pluginManagement>
  </build>

  <profiles>
    <profile>
      <id>macosx-jvm-flags</id>
      <activation>
	<os>
	  <family>mac</family>
	</os>
      </activation>
      <properties>
	<os-jvm-flags>-XstartOnFirstThread</os-jvm-flags>
      </properties>
    </profile>
    
    <profile>
      <id>sign</id>
      <activation>
	<property>
	  <name>BUILD_SIGN</name>
	  <value>true</value>
	</property>
      </activation>
      <build>
	<plugins>
	  <plugin>
	    <groupId>org.eclipse.tycho.extras</groupId>
	    <artifactId>tycho-pack200a-plugin</artifactId>
	    <version>${tycho-extras-version}</version>
	    <executions>
	      <execution>
		<id>pack200-normalize</id>
		<phase>package</phase>
		<goals>
		  <goal>normalize</goal>
		</goals>
	      </execution>
	    </executions>
	  </plugin>
	  <plugin>
	    <groupId>org.eclipse.cbi.maven.plugins</groupId>
	    <artifactId>eclipse-jarsigner-plugin</artifactId>
	    <version>1.1.3</version>
	    <executions>
	      <execution>
		<id>sign</id>
		<phase>package</phase>
		<goals>
		  <goal>sign</goal>
		</goals>
	      </execution>
	    </executions>
	  </plugin>
	  <plugin>
	    <groupId>org.eclipse.tycho.extras</groupId>
	    <artifactId>tycho-pack200b-plugin</artifactId>
	    <version>${tycho-extras-version}</version>
	    <executions>
	      <execution>
		<id>pack200-pack</id>
		<phase>package</phase>
		<goals>
		  <goal>pack</goal>
		</goals>
	      </execution>
	    </executions>
	  </plugin>
	</plugins>
      </build>
      <pluginRepositories>
	<pluginRepository>
	  <id>cbi</id>
	  <url>https://repo.eclipse.org/content/repositories/cbi-releases/</url>
	  <releases>
	    <enabled>true</enabled>
	  </releases>
	  <snapshots>
	    <enabled>false</enabled>
	  </snapshots>
	</pluginRepository>
      </pluginRepositories>
    </profile>
  </profiles>

</project>
